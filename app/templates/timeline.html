{% extends "layouts/base.layout.html" %} {% block styles %}

<link rel="preconnect" href="https://fonts.googleapis.com" />
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
<link
  href="https://fonts.googleapis.com/css2?family=Source+Code+Pro:wght@700&display=swap"
  rel="stylesheet"
/>
<link
  href="{{url_for('static', filename='css/experience.css')}}"
  rel="stylesheet"
/>

{% endblock %} {% block content %}

<div class="container">
  <h1>Timeline</h1>

  <form id="form">
    <div class="form-group">
      <label>Name</label>
      <input
        type="text"
        class="form-control"
        id="name"
        placeholder="your name"
        name="name"
      />
    </div>
    <div class="form-group">
      <label>Email</label>
      <input
        type="text"
        class="form-control"
        id="email"
        placeholder="name@example.com"
        name="email"
      />
    </div>
    <div class="form-group">
      <label>Content</label>
      <input
        type="text"
        class="form-control"
        id="content"
        placeholder="content"
        name="content"
      />
    </div>
    <button type="submit" class="btn btn-primary">Submit</button>
  </form>
  <!-- show the newly added timeline post -->
  <div id="timeline-post">
    <div class="card">
      <div class="card-body">
        <h5 class="card-title">{{ name }}</h5>
        <p class="card-text">{{ content }}</p>
        <p class="card-text"><small class="text-muted">{{ email }}</small></p>
      </div>
    </div>
</div>
<script>
  const form = document.getElementById("form");

  form.addEventListener("submit", function (e) {
    e.preventDefault();

    const payload = new FormData(form);

    fetch('/api/timeline_post', {
      method: "POST",
      body: payload,
    }).then(() => {
      window.location.reload();
    });
  });

  // show the last timeline with get request
  fetch('/api/timeline_post').then((res) => {
    res.json().then((data) => {
      const timelinePost = document.getElementById("timeline-post");
      const name = data.name;
      const content = data.content;
      const email = data.email;
      timelinePost.innerHTML = `
      <div class="card">
        <div class="card-body">
          <h5 class="card-title">${name}</h5>
          <p class="card-text">${content}</p>
          <p class="card-text"><small class="text-muted">${email}</small></p>
        </div>
      </div>
      `;
    });
  });

</script>

{% endblock %}
